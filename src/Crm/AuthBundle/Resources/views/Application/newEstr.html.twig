{% extends 'CrmAuthBundle::layout.html.twig' %}
{#{% extends is_granted('ROLE_CLIENT') ? 'CrmAuthBundle::layout.html.twig' : 'CrmMainBundle::layout.html.twig'  %}#}

{% block title %}
    <title>Заказать карту тахографа с СКЗИ, РФ. ЕСТР Online</title>
    <meta name="description" content="Быстро и удобно заказать карту предприятия для тахографов">
    <meta name="keywords" content="Заказать карту водителя, тахографы, СКЗИ, ЕСТР, РФ, онлайн продажа карт для тахографа">
{% endblock %}

{% block content %}
    <h1 style="text-align: center" class="text-primary">Онлайн оформление карты ЕСТР</h1>
    <p style="text-align: center">
        Карты предназначены для европейских тахографов стандарта ЕСТР.<br />
        Действуют только на территории <b>Европы и РФ</b>.
        <br />
        Цена: <span style="font-weight: bold">{{ company2.priceEstr}} руб.</span><br />
        Доставка: <span style="font-weight: bold">Бесплатно</span><br />
        Срок изготовления: <span style="font-weight: bold">15 дней</span><br />
        <strong>Переход на страницу оплаты - после оформления и сохранения Заявки</strong>
    </p>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/crmmain/kladrapi/jquery.kladr.min.css') }}" rel="stylesheet" media="all">
    <link href="{{ asset('bundles/crmmain/tapmodo-Jcrop/css/jquery.Jcrop.min.css') }}" rel="stylesheet" media="all">
    <link href="{{ asset('bundles/crmmain/lib/chosen/chosen.min.css') }}" rel="stylesheet" media="all">
    <style>


        .block-form{
            margin: 0 auto;
        }
        select{
            width: 220px;
        }
        #crm_mainbundle_user_orderType-styler .jq-selectbox__select-text{
            width: 214px !important;
        }
        .master{
            display: none;
        }
        .mini{
            font-size: 12px;
            color: #555555;
        }
        .zipcode{
            width: 175px !important;
        }
        .date_day{
            width: 70px;
        }
        .date_month{
            width: 100px;
        }
        .date_year{
            width: 100px;
        }
        .typeCardFileRow, .typeCardFileRow2, .typeCardFile, .citizenship, .petition, .petition-td{
            display: none;
        }
        #crm_mainbundle_user_passportSerial{
            width: 105px;
        }
        #crm_mainbundle_user_passportNumber{
            width: 160px;
        }
        .jq-selectbox__select-text{
            font-size: 13px;
        }
        label.required{
            color: inherit !important;
        }
        select{
            margin: 10px 0;
        }
        .delivery{
            /*display: none;*/
        }
    </style>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset("bundles/crmmain/lib/chosen/chosen.jquery.js") }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/crmmain/tapmodo-Jcrop/js/jquery.Jcrop.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/crmmain/kladrapi/jquery.kladr.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/crmauth/javascripts/file.js') }}" type="text/javascript"></script>
    <script>

        $(document).ready(function(){
            $('#submit').click(function () {
                if ($('#crm_mainbundle_user_typeCard').val()==1){
                    if (
                        $('#crm_mainbundle_user_dateEndCard').val() == '' &&
                        $('#copyLastCardFile-styler .jq-file__name').html() == 'Файл не выбран'
                    ){
                        $('#errorlastCard').html('Заполните, пожалуйста, дату окончания или копию прошлой карты');
                        return false;
                    }else{
                        $('#errorlastCard').html('');
                        return true;
                    }
                }
            });

            $('#crm_mainbundle_user_typeCard').change(function(){
                if ($(this).val()!= 0 ){
                    $('.typeCardFile').css('display','table-cell');
                    $('.typeCardFileRow2').css('display','table-row');
                    $('.typeCardFileRow2').css('display','table-row');
                }else{
                    $('.typeCardFile').css('display','none');
                    $('.typeCardFileRow2').css('display','none');
                    $('.typeCardFileRow').css('display','none');
                }
            });


            $('#crm_mainbundle_user_citizenship').change(function(){
                if ($(this).val()!= 0){
                    $('.citizenship').css('display','table-cell')
                }else{
                    $('.citizenship').css('display','none')
                }
            });

            $('#crm_mainbundle_user_myPetition').change(function(){
                if ($(this).val()!= 0){
                    $('.petition').css('display','table-row');
                    $('.petition-td').css('display','table-cell');
                }else{
                    $('.petition').css('display','none');
                    $('.petition-td').css('display','none');
                }
            });

            $('#delivery').change(function(){
                if ($(this).val()!= 0){
                    $('.delivery').css('display','table-row');
                    $('.delivery-td').css('display','table-cell');
                }else{
                    $('.delivery').css('display','none');
                    $('.delivery-td').css('display','none');
                }
            });

            $('#crm_mainbundle_user_citizenship').change(function(){
                if ($(this).val()!= 0){
                    $('.citizenship').css('display','table-cell')
                }else{
                    $('.citizenship').css('display','none')
                }
            });

            $( '#crm_mainbundle_user_deliveryAdrs_region' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                type: $.kladr.type.region,
                select: function(obj){
                    $('#crm_mainbundle_user_deliveryAdrs_region').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_deliveryAdrs_region').trigger('refresh');
                }
            });

            $( '#crm_mainbundle_user_deliveryAdrs_area' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[deliveryAdrs][region]"]',
                type: $.kladr.type.district,
                select: function(obj){
                    $('#crm_mainbundle_user_deliveryAdrs_area').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_deliveryAdrs_area').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_deliveryAdrs_city' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[deliveryAdrs][area]"]',
                type: $.kladr.type.city,
                select: function(obj){
                    $('#crm_mainbundle_user_deliveryAdrs_city').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_deliveryAdrs_city').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_deliveryAdrs_street' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[deliveryAdrs][city]"]',
                type: $.kladr.type.street,
                select: function(obj){
                    $('#crm_mainbundle_user_deliveryAdrs_street').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_deliveryAdrs_street').trigger('refresh');
                }
            });
            $('#crm_mainbundle_user_deliveryAdrs_house' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[deliveryAdrs][street]"]',
                type: $.kladr.type.building,
                select: function(obj){
                    $('#crm_mainbundle_user_deliveryAdrs_zipcode').val(obj.zip);
                    var home = obj.name.split('к');
                    $('#crm_mainbundle_user_deliveryAdrs_house').val(home[0]);
                    if (home[1] != undefined){
                        $('#crm_mainbundle_user_deliveryAdrs_corp').val(home[1]);
                    }

                }
            });

            /////////////////////////////////////////////

            $( '#crm_mainbundle_user_petitionAdrs_region' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                type: $.kladr.type.region,
                select: function(obj){
                    $('#crm_mainbundle_user_petitionAdrs_region').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_petitionAdrs_region').trigger('refresh');
                }
            });

            $( '#crm_mainbundle_user_petitionAdrs_area' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[petitionAdrs][region]"]',
                type: $.kladr.type.district,
                select: function(obj){
                    $('#crm_mainbundle_user_petitionAdrs_area').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_petitionAdrs_area').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_petitionAdrs_city' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[petitionAdrs][area]"]',
                type: $.kladr.type.city,
                select: function(obj){
                    $('#crm_mainbundle_user_petitionAdrs_city').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_petitionAdrs_city').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_petitionAdrs_street' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[petitionAdrs][city]"]',
                type: $.kladr.type.street,
                select: function(obj){
                    $('#crm_mainbundle_user_petitionAdrs_street').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_petitionAdrs_street').trigger('refresh');
                }
            });
            $('#crm_mainbundle_user_petitionAdrs_house' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[petitionAdrs][street]"]',
                type: $.kladr.type.building,
                select: function(obj){
                    $('#crm_mainbundle_user_petitionAdrs_zipcode').val(obj.zip);
                    var home = obj.name.split('к');
                    $('#crm_mainbundle_user_petitionAdrs_house').val(home[0]);
                    if (home[1] != undefined){
                        $('#crm_mainbundle_user_petitionAdrs_corp').val(home[1]);
                    }

                }
            });

            ////////////////////////////////////////////

            $( '#crm_mainbundle_user_registeredAdrs_region' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                type: $.kladr.type.region,
                select: function(obj){
                    $('#crm_mainbundle_user_registeredAdrs_region').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_registeredAdrs_region').trigger('refresh');
                }
            });

            $( '#crm_mainbundle_user_registeredAdrs_area' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[registeredAdrs][region]"]',
                type: $.kladr.type.district,
                select: function(obj){
                    $('#crm_mainbundle_user_registeredAdrs_area').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_registeredAdrs_area').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_registeredAdrs_city' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[registeredAdrs][area]"]',
                type: $.kladr.type.city,
                select: function(obj){
                    $('#crm_mainbundle_user_registeredAdrs_city').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_registeredAdrs_city').trigger('refresh');
                }
            });

            $('#crm_mainbundle_user_registeredAdrs_street' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[registeredAdrs][city]"]',
                type: $.kladr.type.street,
                select: function(obj){
                    $('#crm_mainbundle_user_registeredAdrs_street').val(obj.typeShort+'.'+obj.name);
                    $('#crm_mainbundle_user_registeredAdrs_street').trigger('refresh');
                }
            });
            $('#crm_mainbundle_user_registeredAdrs_house' ).kladr({
                token: '541ee4ac7c52392c7d8b457e',
                key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                parentInput: '[name="crm_mainbundle_user[registeredAdrs][street]"]',
                type: $.kladr.type.building,
                select: function(obj){
                    $('#crm_mainbundle_user_registeredAdrs_zipcode').val(obj.zip);
                    var home = obj.name.split('к');
                    $('#crm_mainbundle_user_registeredAdrs_house').val(home[0]);
                    if (home[1] != undefined){
                        $('#crm_mainbundle_user_registeredAdrs_corp').val(home[1]);
                    }

                }
            });

            $('input:text,.date_day,.date_month,.date_year').styler();
//            $('#crm_mainbundle_user_typeCard').chosen({disable_search_threshold: 10,width: 270,placeholder_text_single: 'Выберите из списка'});
//            $('#crm_mainbundle_user_driverDocCountry').chosen({disable_search_threshold: 10,width: 270,placeholder_text_single: 'Выберите из списка'});
            $(".zipcode").mask("999999");
            $(".phone").mask("+7 (999) 999-9999");
            $(".code").mask("999-999");
            $(".snils").mask("999-999-999 99");


            $.mask.definitions['d'] = "[a-zA-Z0-9а-яА-Я]";
            $('.driverNumber').mask("dddd9999?99");
            $('.oldCardNumber').mask("RUDddddddddddddd");

            $('.cardType').change(function(){
                $('input, select').trigger('refresh');
                if ($('.cardType').val() == 1){
                    $('.master').css('display','table-row');
                }else{
                    $('.master').css('display','none');
                }
            });

            {% if form.vars.value.myPetition is defined and form.vars.value.myPetition != 0 %}
            $('.petition').css('display','table-row');
            $('.petition-td').css('display','table-cell');
            {% endif %}
        });
    </script>
{% endblock %}
